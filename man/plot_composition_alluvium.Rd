% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_composition_alluvium.R
\name{plot_composition_alluvium}
\alias{plot_composition_alluvium}
\title{Plot Taxonomic Composition as Alluvial Diagram}
\usage{
plot_composition_alluvium(
  data,
  taxon_column = "family",
  id_column = NULL,
  palette = "Paired",
  alpha = 0.7,
  y_labels_format = TRUE,
  y_accuracy = 1,
  y_expand = c(0, 0),
  legend_position = "right",
  legend_key_height = 0.4,
  legend_key_width = 0.6,
  base_size = 11
)
}
\arguments{
\item{data}{A data frame in wide format with one taxonomic/identifier column
and multiple sample columns containing relative abundances.}

\item{taxon_column}{Character string. Name of the column containing taxonomic
identifiers (e.g., "family", "genus", "species"). Default is "family".}

\item{id_column}{Character string. Alternative name for taxonomic column when
\code{taxon_column} is not found. Default is NULL.}

\item{palette}{Character string or vector. Color palette for the alluvium.
Can be a single RColorBrewer palette name or a vector of colors.
Default is "Paired".}

\item{alpha}{Numeric value between 0 and 1 for transparency. Default is 0.7.}

\item{y_labels_format}{Logical. Whether to format y-axis labels as percentages.
Default is TRUE.}

\item{y_accuracy}{Numeric value. Precision for y-axis percentage labels.
Default is 1 (i.e., 1 decimal place).}

\item{y_expand}{Numeric vector of length 2. Y-axis expansion.
Default is c(0, 0) for no expansion.}

\item{legend_position}{Character string. Position of the legend.
Options: "right", "left", "top", "bottom", "none". Default is "right".}

\item{legend_key_height}{Numeric value. Height of legend keys. Default is 0.4.}

\item{legend_key_width}{Numeric value. Width of legend keys. Default is 0.6.}

\item{base_size}{Numeric value. Base font size for text. Default is 11.}
}
\value{
A ggplot object displaying the alluvial diagram.
}
\description{
Create an alluvial diagram (Sankey-like plot) to visualize taxonomic
composition across multiple sample groups. This function is ideal for
showing how the relative abundance of different taxa changes across
conditions or time points, commonly used in microbiome or virome studies.
}
\details{
The function performs the following operations:
\enumerate{
  \item Validates input data format
  \item Calculates row sums to determine ordering
  \item Converts data from wide to long format
  \item Creates alluvial diagram with stratums and flows
  \item Applies professional styling
}

The alluvial diagram shows:
\itemize{
  \item Stratums: Taxa on the y-axis (ordered by total abundance)
  \item Flows: Connections showing relative abundance changes across groups
  \item Colors: Distinct colors for each taxon
}
}
\note{
\itemize{
  \item Requires \code{ggalluvial} package
  \item Y-axis values are automatically scaled to percentages
  \item Taxa are ordered by total abundance across all samples
  \item Input data should contain relative abundances (not raw counts)
}
}
\examples{
\dontrun{
library(bioRtools)
library(readxl)
library(dplyr)

# Read data from Excel file
df <- read_excel("data.xlsx", sheet = "Fig.1a", skip = 1)

# Basic alluvial plot
p <- plot_composition_alluvium(
  df,
  taxon_column = "Viral Taxonomy (family)"
)
print(p)

# Custom color palette and formatting
p_custom <- plot_composition_alluvium(
  df,
  taxon_column = "Viral Taxonomy (family)",
  palette = "Set2",
  alpha = 0.8,
  y_accuracy = 0.1
)
print(p_custom)

# Custom colors vector
p_custom2 <- plot_composition_alluvium(
  df,
  taxon_column = "Viral Taxonomy (family)",
  palette = c("#E41A1C", "#377EB8", "#4DAF4A", "#984EA3")
)
print(p_custom2)
}

}
\author{
Xiang LI \email{lixiang117423@foxmail.com}
}
