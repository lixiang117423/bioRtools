% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/admixture_phylo_analysis.R
\name{admixture_phylo_analysis}
\alias{admixture_phylo_analysis}
\title{Analyze Admixture results with phylogenetic tree and visualization}
\usage{
admixture_phylo_analysis(
  admixture_path,
  tree_file = NULL,
  sample_group = NULL,
  k_range = NULL,
  color_scale = "aaas",
  tree_color_scale = "d3",
  manual_colors = NULL,
  tree_width = 0.2,
  tree_linewidth = 0.2,
  tip_point_size = 0.1,
  show_branch_length = FALSE,
  verbose = TRUE
)
}
\arguments{
\item{admixture_path}{Character string specifying the directory path containing
Admixture .Q files and .fam file. All .Q files in this directory will be processed.}

\item{tree_file}{Optional character string specifying the path to the phylogenetic tree
file (Newick format). If provided, a phylogenetic tree will be drawn and combined
with the admixture plot. If NULL, only admixture plot will be returned. Default is NULL.}

\item{sample_group}{Optional data frame containing sample grouping information
with columns 'label' (sample names), 'group', and optionally 'color'.
Can also be a file path to read the grouping information.
If provided when tree_file is given, tree tips will be colored by groups. Default is NULL.}

\item{k_range}{Integer vector specifying which K values to include in the
analysis. Can be specified as a range (e.g., 2:5) or specific values
(e.g., c(2,3,5)). If NULL, all available K values will be used. Default is NULL.}

\item{color_scale}{Character string specifying the color scale to use for admixture.
Options: "default" (uses optimized base colors), "aaas", "npg", "lancet",
"jco", "ucscgb", "uchicago", "simpsons", "rickandmorty", or "manual".
Default is "aaas".}

\item{tree_color_scale}{Character string specifying the color scale for tree groups.
Options: "d3", "aaas", "npg", "lancet", etc. Default is "d3".}

\item{manual_colors}{Character vector of colors for manual admixture color scale.
Only used when color_scale = "manual". Default is NULL.}

\item{tree_width}{Numeric value specifying the relative width of the tree plot.
Default is 0.2 (20% of total width).}

\item{tree_linewidth}{Numeric value specifying the line width for tree branches.
Default is 0.2.}

\item{tip_point_size}{Numeric value specifying the size of tip points in tree.
Default is 0.1.}

\item{show_branch_length}{Logical indicating whether to show branch lengths.
Default is FALSE.}

\item{verbose}{Logical indicating whether to print progress information.
Default is TRUE.}

\item{k_ncol}{Integer specifying number of columns for K value facets.
Default is 9.}
}
\value{
A list containing:
\describe{
  \item{combined_plot}{Combined plot object (aplot) when tree_file provided, otherwise NULL.}
  \item{admixture_plot}{ggplot2 object of the admixture structure plot.}
  \item{tree_plot}{ggplot2/ggtree object when tree_file provided, otherwise NULL.}
}
}
\description{
Process Admixture .Q files and create population structure plots with integrated
phylogenetic tree visualization using ggplot2 and ggtree. This function creates
a rotated layout with samples on Y-axis and values on X-axis, with K values
arranged horizontally, and optionally combines with a phylogenetic tree.
}
\details{
The function has two distinct modes based on whether tree_file is provided:

**Mode 1: Without tree_file (Traditional Layout)**
\enumerate{
  \item Samples arranged horizontally (X-axis)
  \item K values arranged vertically as facets (ncol = 1)
  \item Strip labels on the left with 90-degree rotation
  \item Returns only admixture plot
}

**Mode 2: With tree_file (Rotated Layout)**
\enumerate{
  \item Reading phylogenetic tree and extracting tip order with proper label cleaning
  \item Samples arranged vertically (Y-axis)
  \item K values arranged horizontally as facets (ncol = auto-calculated from k_range)
  \item Strip labels on top with 90-degree rotation
  \item Optional sample grouping with colored tree tips
  \item Returns combined plot, admixture plot, and tree plot
}

The sample_group parameter can be:
\itemize{
  \item A data.frame with columns: 'label', 'group', and optionally 'color'
  \item A file path to a tab-delimited file with the same columns
  \item NULL for no grouping (default)
}
}
\note{
\itemize{
  \item Requires tidyverse and ggplot2 packages
  \item When using phylogenetic features: requires ape, treeio, ggtree, aplot packages
  \item When using ggsci color scales: requires ggsci package
  \item Returns aplot object when tree provided, ggplot2 object otherwise
  \item No files are saved automatically - use ggsave() if needed
}
}
\examples{
library(bioRtools)
\dontrun{
# Mode 1: Analysis without tree (traditional layout)
result <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/"
)
print(result$admixture_plot)  # ggplot2 object
# result$combined_plot and result$tree_plot will be NULL

# Mode 2: Analysis with tree (rotated layout)
result <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/",
  tree_file = "path/to/phylogenetic_tree.nwk"
)
print(result$combined_plot)   # aplot combined object
print(result$admixture_plot)  # ggplot2 admixture plot
print(result$tree_plot)       # ggtree plot

# Mode 2 with sample grouping (data frame)
sample_group <- data.frame(
  label = c("sample1", "sample2", "sample3"),
  group = c("A", "A", "B"),
  color = c("A", "A", "B")
)

result <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/",
  tree_file = "path/to/phylogenetic_tree.nwk",
  sample_group = sample_group,
  k_range = 2:6
)

# Mode 2 with sample grouping (file path)
result <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/",
  tree_file = "path/to/phylogenetic_tree.nwk",
  sample_group = "path/to/sample_groups.txt"  # Tab-delimited file
)

# Custom styling
result <- admixture_phylo_analysis(
  admixture_path = "path/to/admixture/results/",
  tree_file = "path/to/phylogenetic_tree.nwk",
  color_scale = "npg",
  tree_color_scale = "aaas",
  tree_width = 0.3,
  tip_point_size = 0.2
)
}

}
