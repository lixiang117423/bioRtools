% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_wgcna.R
\name{run_wgcna_analysis}
\alias{run_wgcna_analysis}
\title{Weighted Gene Co-expression Network Analysis (WGCNA)}
\usage{
run_wgcna_analysis(
  expression_data,
  sample_info,
  output_dir,
  trait_columns,
  gene_id_col = "gene_id",
  sample_col = "sample",
  expression_col = "FPKM",
  sample_id_col = "treatment",
  min_gene_sd = 0.1,
  power_vector = 1:30,
  min_module_size = 50,
  max_block_size = NULL,
  tom_type = "signed",
  correlation_method = "pearson",
  save_network = TRUE,
  plot_width = 12,
  plot_height = 6,
  plot_dpi = 500,
  verbose = TRUE
)
}
\arguments{
\item{expression_data}{Either a file path to expression data (tab-delimited) or 
a data frame containing expression data. Required columns: sample ID, gene ID, 
and expression values.}

\item{sample_info}{Either a file path to sample information (Excel format) or 
a data frame containing sample metadata. Must include sample IDs and trait columns.}

\item{output_dir}{Character. Directory path where results and plots will be saved.}

\item{trait_columns}{Character vector. Column names in sample_info to use for 
module-trait association analysis.}

\item{gene_id_col}{Character. Column name containing gene IDs in expression_data.
Default: "gene_id".}

\item{sample_col}{Character. Column name containing sample IDs in expression_data.
Default: "sample".}

\item{expression_col}{Character. Column name containing expression values in 
expression_data. Default: "FPKM".}

\item{sample_id_col}{Character. Column name containing sample IDs in sample_info.
Default: "treatment".}

\item{min_gene_sd}{Numeric. Minimum standard deviation threshold for gene filtering.
Genes with SD <= this value will be excluded. Default: 0.1.}

\item{power_vector}{Integer vector. Powers to test for soft threshold selection.
Default: 1:30.}

\item{min_module_size}{Integer. Minimum number of genes required for a module.
Default: 50.}

\item{max_block_size}{Integer. Maximum block size for module detection. If NULL,
uses all genes in one block. Default: NULL.}

\item{tom_type}{Character. Type of Topological Overlap Matrix. Options: "signed",
"unsigned", "signed hybrid". Default: "signed".}

\item{correlation_method}{Character. Correlation method for module-trait association.
Options: "pearson", "spearman", "kendall". Default: "pearson".}

\item{save_network}{Logical. Whether to save the network object as RData file.
Default: TRUE.}

\item{plot_width}{Numeric. Width of saved plots in inches. Default: 12.}

\item{plot_height}{Numeric. Height of saved plots in inches. Default: 6.}

\item{plot_dpi}{Numeric. DPI resolution for saved plots. Default: 500.}

\item{verbose}{Logical. Whether to print progress messages. Default: TRUE.}
}
\value{
A list containing:
\describe{
  \item{network}{The WGCNA network object from blockwiseModules}
  \item{module_colors}{Character vector of module color assignments for each gene}
  \item{module_trait_cor}{Matrix of module-trait correlations}
  \item{module_trait_pvalue}{Matrix of module-trait correlation p-values}
  \item{soft_power}{Selected soft threshold power value}
  \item{gene_module_mapping}{Data frame mapping genes to modules with colors}
  \item{module_eigengenes}{Matrix of module eigengenes}
  \item{module_summary}{Data frame summarizing module sizes}
  \item{expression_matrix}{Processed expression matrix used for analysis}
  \item{trait_matrix}{Processed trait matrix used for correlation analysis}
}
}
\description{
A comprehensive function to perform WGCNA including data preprocessing, 
network construction, module identification, and module-trait association analysis.
}
\details{
This function performs a complete WGCNA pipeline:
\enumerate{
  \item Data loading and preprocessing with log2(x+1) transformation
  \item Quality control and gene filtering based on standard deviation
  \item Soft threshold power selection for scale-free topology
  \item Network construction using blockwiseModules
  \item Module identification and gene assignment
  \item Module-trait association analysis
  \item Generation of diagnostic plots and result files
}

The function automatically creates the output directory if it doesn't exist and
generates multiple output files including correlation matrices, gene-module 
mappings, and visualization plots.
}
\note{
Required packages: tidyverse, WGCNA, patchwork, readxl, pheatmap.
Gene IDs containing ":" will be split and the second part will be used.
Expression values are log2(x+1) transformed before analysis.
}
\examples{
\dontrun{
# Using file paths
result1 <- run_wgcna_analysis(
  expression_data = "expression_data.txt",
  sample_info = "sample_info.xlsx",
  output_dir = "wgcna_results",
  trait_columns = c("time", "treatment")
)

# Using data frames with custom column names
expr_df <- read.delim("expression.txt")
sample_df <- read_excel("samples.xlsx")

result2 <- run_wgcna_analysis(
  expression_data = expr_df,
  sample_info = sample_df,
  output_dir = "wgcna_results",
  trait_columns = c("timepoint", "genotype"),
  gene_id_col = "transcript_id",
  expression_col = "TPM",
  sample_id_col = "sample_name"
)

# Access results
print(result1$module_trait_cor)
head(result1$gene_module_mapping)
}

}
\seealso{
\code{\link[WGCNA]{blockwiseModules}}, \code{\link[WGCNA]{pickSoftThreshold}}
}
\author{
Your Name
}
